# =====================================================
# E-COMPTA-IA - CONFIGURATION TESTS (PostgreSQL)
# =====================================================

# Base de donn√©es de test PostgreSQL
spring.datasource.url=${TEST_DATABASE_URL:jdbc:postgresql://localhost:5432/ecomptaia_db}
spring.datasource.username=${TEST_DATABASE_USERNAME:postgres}
spring.datasource.password=^Dq^V)o:]S~"={<q}~MF;I}W_)|*2;`7
spring.datasource.driver-class-name=org.postgresql.Driver

# Hibernate/JPA
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.use_sql_comments=false
spring.jpa.properties.hibernate.default_schema=app_test
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.schemas=app_test
spring.flyway.baseline-on-migrate=true
spring.flyway.baseline-version=0
spring.flyway.validate-on-migrate=true
spring.flyway.clean-disabled=false
spring.flyway.clean-on-validation-error=true
spring.flyway.clean-on-migrate=true
spring.flyway.baseline-on-migrate=true
spring.flyway.baseline-version=0
spring.flyway.validate-on-migrate=true
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.schemas=app_test
spring.sql.init.mode=always
spring.sql.init.schema-locations=classpath:db/migration
spring.sql.init.data-locations=classpath:data.sql
spring.jpa.defer-datasource-initialization=true
spring.sql.init.mode=always
spring.sql.init.schema-locations=classpath:db/migration
spring.sql.init.data-locations=classpath:data.sql
spring.jpa.defer-datasource-initialization=true

# Flyway migrations
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true
spring.flyway.baseline-version=0
spring.flyway.validate-on-migrate=true
spring.flyway.clean-disabled=false
spring.flyway.clean-on-validation-error=true
spring.flyway.schemas=app_test

# Pool
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=1
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1200000
spring.datasource.hikari.connection-timeout=20000

# Logs
logging.level.root=WARN
logging.level.com.ecomptaia=WARN
logging.pattern.console=%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n

# Server
server.port=0

# Security (test)
spring.security.user.name=test
spring.security.user.password=test123
spring.security.user.roles=ADMIN

# CORS
spring.web.cors.allowed-origins=*
spring.web.cors.allowed-methods=*
spring.web.cors.allowed-headers=*
spring.web.cors.allow-credentials=true

# Multipart
spring.servlet.multipart.max-file-size=1MB
spring.servlet.multipart.max-request-size=1MB

# Metrics
management.endpoints.web.exposure.include=health
management.endpoint.health.show-details=never
management.metrics.export.prometheus.enabled=false

# Test config
spring.test.database.replace=none
spring.jpa.defer-datasource-initialization=false
spring.main.allow-bean-definition-overriding=true

# External integrations off in tests
ecomptaia.integrations.banking.enabled=false
ecomptaia.integrations.tax.enabled=false
ecomptaia.integrations.social.enabled=false

# Cache
spring.cache.type=none

# Tomcat
tomcat.connection-timeout=5000

# Disable heavy autoconfigs unused in tests
spring.autoconfigure.exclude=\
 org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration,\
 org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration,\
 org.springframework.boot.autoconfigure.thymeleaf.ThymeleafAutoConfiguration

# JWT properties for test context
spring.security.jwt.secret=test_jwt_secret
spring.security.jwt.expiration=3600000








