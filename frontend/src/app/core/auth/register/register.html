<div class="register-container">
  <mat-card class="register-card">
    <mat-card-header>
      <mat-card-title class="register-title">
        <mat-icon class="register-icon">person_add</mat-icon>
        Inscription ERP E-COMPTA-IA
      </mat-card-title>
    </mat-card-header>
    
    <mat-card-content>
      <mat-stepper #stepper [linear]="true" [selectedIndex]="currentStep">
        
        <!-- Étape 1: Informations personnelles -->
        <mat-step [stepControl]="registerForm" label="Informations personnelles">
          <form [formGroup]="registerForm" class="register-form">
            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Prénom</mat-label>
                <input matInput formControlName="firstName" placeholder="Votre prénom">
                <mat-icon matSuffix>person</mat-icon>
                <mat-error *ngIf="registerForm.get('firstName')?.hasError('required')">
                  {{ getErrorMessage('firstName') }}
                </mat-error>
                <mat-error *ngIf="registerForm.get('firstName')?.hasError('minlength')">
                  {{ getErrorMessage('firstName') }}
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Nom</mat-label>
                <input matInput formControlName="lastName" placeholder="Votre nom">
                <mat-icon matSuffix>person</mat-icon>
                <mat-error *ngIf="registerForm.get('lastName')?.hasError('required')">
                  {{ getErrorMessage('lastName') }}
                </mat-error>
                <mat-error *ngIf="registerForm.get('lastName')?.hasError('minlength')">
                  {{ getErrorMessage('lastName') }}
                </mat-error>
              </mat-form-field>
            </div>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Nom d'utilisateur</mat-label>
              <input matInput formControlName="username" placeholder="Choisissez un nom d'utilisateur">
              <mat-icon matSuffix>account_circle</mat-icon>
              <mat-error *ngIf="registerForm.get('username')?.hasError('required')">
                {{ getErrorMessage('username') }}
              </mat-error>
              <mat-error *ngIf="registerForm.get('username')?.hasError('minlength')">
                {{ getErrorMessage('username') }}
              </mat-error>
              <mat-error *ngIf="registerForm.get('username')?.hasError('maxlength')">
                {{ getErrorMessage('username') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Email</mat-label>
              <input matInput formControlName="email" type="email" placeholder="votre@email.com">
              <mat-icon matSuffix>email</mat-icon>
              <mat-error *ngIf="registerForm.get('email')?.hasError('required')">
                {{ getErrorMessage('email') }}
              </mat-error>
              <mat-error *ngIf="registerForm.get('email')?.hasError('email')">
                {{ getErrorMessage('email') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Téléphone (optionnel)</mat-label>
              <input matInput formControlName="phoneNumber" placeholder="+33 1 23 45 67 89">
              <mat-icon matSuffix>phone</mat-icon>
              <mat-error *ngIf="registerForm.get('phoneNumber')?.hasError('pattern')">
                {{ getErrorMessage('phoneNumber') }}
              </mat-error>
            </mat-form-field>
          </form>
          
          <div class="step-actions">
            <button mat-raised-button color="primary" (click)="nextStep()" [disabled]="!isCurrentStepValid()">
              Suivant
              <mat-icon>arrow_forward</mat-icon>
            </button>
          </div>
        </mat-step>

        <!-- Étape 2: Mot de passe -->
        <mat-step [stepControl]="registerForm" label="Sécurité">
          <form [formGroup]="registerForm" class="register-form">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Mot de passe</mat-label>
              <input matInput 
                     [type]="hidePassword ? 'password' : 'text'"
                     formControlName="password" 
                     placeholder="Choisissez un mot de passe sécurisé">
              <button mat-icon-button 
                      matSuffix 
                      type="button"
                      (click)="hidePassword = !hidePassword">
                <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
              </button>
              <mat-error *ngIf="registerForm.get('password')?.hasError('required')">
                {{ getErrorMessage('password') }}
              </mat-error>
              <mat-error *ngIf="registerForm.get('password')?.hasError('minlength')">
                {{ getErrorMessage('password') }}
              </mat-error>
              <mat-error *ngIf="registerForm.get('password')?.hasError('passwordStrength')">
                {{ getErrorMessage('password') }}
              </mat-error>
            </mat-form-field>

            <div class="password-strength" *ngIf="registerForm.get('password')?.value">
              <span class="strength-label">Force du mot de passe:</span>
              <span class="strength-value" [class]="'strength-' + getPasswordStrength().toLowerCase().replace(' ', '-')">
                {{ getPasswordStrength() }}
              </span>
            </div>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Confirmer le mot de passe</mat-label>
              <input matInput 
                     [type]="hideConfirmPassword ? 'password' : 'text'"
                     formControlName="confirmPassword" 
                     placeholder="Confirmez votre mot de passe">
              <button mat-icon-button 
                      matSuffix 
                      type="button"
                      (click)="hideConfirmPassword = !hideConfirmPassword">
                <mat-icon>{{hideConfirmPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
              </button>
              <mat-error *ngIf="registerForm.get('confirmPassword')?.hasError('required')">
                {{ getErrorMessage('confirmPassword') }}
              </mat-error>
              <mat-error *ngIf="registerForm.hasError('passwordMismatch')">
                {{ getErrorMessage('confirmPassword') }}
              </mat-error>
            </mat-form-field>
          </form>
          
          <div class="step-actions">
            <button mat-button (click)="previousStep()">
              <mat-icon>arrow_back</mat-icon>
              Précédent
            </button>
            <button mat-raised-button color="primary" (click)="nextStep()" [disabled]="!isCurrentStepValid()">
              Suivant
              <mat-icon>arrow_forward</mat-icon>
            </button>
          </div>
        </mat-step>

        <!-- Étape 3: Finalisation -->
        <mat-step [stepControl]="registerForm" label="Finalisation">
          <form [formGroup]="registerForm" class="register-form">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Nom de l'entreprise (optionnel)</mat-label>
              <input matInput formControlName="companyName" placeholder="Nom de votre entreprise">
              <mat-icon matSuffix>business</mat-icon>
            </mat-form-field>

            <div class="terms-section">
              <mat-checkbox formControlName="acceptTerms" class="terms-checkbox">
                J'accepte les <a href="/terms" target="_blank">conditions d'utilisation</a> 
                et la <a href="/privacy" target="_blank">politique de confidentialité</a>
              </mat-checkbox>
              <mat-error *ngIf="registerForm.get('acceptTerms')?.hasError('required') && registerForm.get('acceptTerms')?.touched">
                Vous devez accepter les conditions d'utilisation
              </mat-error>
            </div>
          </form>
          
          <div class="step-actions">
            <button mat-button (click)="previousStep()">
              <mat-icon>arrow_back</mat-icon>
              Précédent
            </button>
            <button mat-raised-button 
                    color="primary" 
                    (click)="onSubmit()" 
                    [disabled]="isLoading || registerForm.invalid">
              <mat-spinner *ngIf="isLoading" diameter="20" class="button-spinner"></mat-spinner>
              <span *ngIf="!isLoading">Créer mon compte</span>
              <span *ngIf="isLoading">Création...</span>
            </button>
          </div>
        </mat-step>
      </mat-stepper>
    </mat-card-content>

    <mat-card-actions class="register-actions">
      <button mat-button color="primary" routerLink="/login">
        <mat-icon>login</mat-icon>
        Se connecter
      </button>
    </mat-card-actions>
  </mat-card>
</div>
